<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Pharmacy Support</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select, textarea, button { margin-top: 5px; padding: 5px; width: 100%; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    .lang-btn { margin-right: 10px; }
  </style>
</head>
<body>
  <h2 id="title">Muammo haqida xabar berish</h2>

  <button class="lang-btn" onclick="setLang('uz')">UZ</button>
  <button class="lang-btn" onclick="setLang('ru')">RU</button>
  <button class="lang-btn" onclick="setLang('en')">EN</button>

  <form id="reportForm">
    <label for="shop" id="shopLabel">Dorixona nomi:</label>
    <input type="text" id="shop" placeholder="Shop name">

    <label for="device" id="deviceLabel">Qurilma:</label>
    <select id="device">
      <option value="Kompyuter">Kompyuter</option>
      <option value="Kamera">Kamera</option>
      <option value="Terminal">Terminal</option>
      <option value="Chek apparat">Chek apparat</option>
      <option value="Skaner">Skaner</option>
      <option value="WiFi">Wi-Fi</option>
      <option value="Boshqa">Boshqa</option>
    </select>

    <label for="description" id="descLabel">Tavsif:</label>
    <textarea id="description"></textarea>

    <button type="submit" id="submitBtn">Yuborish</button>
  </form>

  <h2 id="reportsTitle">Barcha xabarlar</h2>
  <table>
    <thead>
      <tr>
        <th id="shopCol">Dorixona</th>
        <th id="deviceCol">Qurilma</th>
        <th id="descCol">Tavsif</th>
        <th id="statusCol">Holati</th>
        <th id="dateCol">Sana</th>
        <th id="actionCol">Amal</th>
      </tr>
    </thead>
    <tbody id="reportsTable"></tbody>
  </table>

  <script>
    let currentLang = "uz";

    const translations = {
      uz: {
        title: "Muammo haqida xabar berish",
        shopLabel: "Dorixona nomi:",
        deviceLabel: "Qurilma:",
        descLabel: "Tavsif:",
        submitBtn: "Yuborish",
        reportsTitle: "Barcha xabarlar",
        shopCol: "Dorixona",
        deviceCol: "Qurilma",
        descCol: "Tavsif",
        statusCol: "Holati",
        dateCol: "Sana",
        actionCol: "Amal",
        status_Pending: "Kutilmoqda",
        status_Completed: "Yakunlangan",
        complete: "Yakunlash"
      },
      ru: {
        title: "Сообщить о проблеме",
        shopLabel: "Название аптеки:",
        deviceLabel: "Устройство:",
        descLabel: "Описание:",
        submitBtn: "Отправить",
        reportsTitle: "Все заявки",
        shopCol: "Аптека",
        deviceCol: "Устройство",
        descCol: "Описание",
        statusCol: "Статус",
        dateCol: "Дата",
        actionCol: "Действие",
        status_Pending: "В ожидании",
        status_Completed: "Завершено",
        complete: "Завершить"
      },
      en: {
        title: "Report an Issue",
        shopLabel: "Shop name:",
        deviceLabel: "Device:",
        descLabel: "Description:",
        submitBtn: "Submit",
        reportsTitle: "All Reports",
        shopCol: "Shop",
        deviceCol: "Device",
        descCol: "Description",
        statusCol: "Status",
        dateCol: "Date",
        actionCol: "Action",
        status_Pending: "Pending",
        status_Completed: "Completed",
        complete: "Complete"
      }
    };

    function setLang(lang) {
      currentLang = lang;
      document.getElementById("title").innerText = translations[lang].title;
      document.getElementById("shopLabel").innerText = translations[lang].shopLabel;
      document.getElementById("deviceLabel").innerText = translations[lang].deviceLabel;
      document.getElementById("descLabel").innerText = translations[lang].descLabel;
      document.getElementById("submitBtn").innerText = translations[lang].submitBtn;
      document.getElementById("reportsTitle").innerText = translations[lang].reportsTitle;
      document.getElementById("shopCol").innerText = translations[lang].shopCol;
      document.getElementById("deviceCol").innerText = translations[lang].deviceCol;
      document.getElementById("descCol").innerText = translations[lang].descCol;
      document.getElementById("statusCol").innerText = translations[lang].statusCol;
      document.getElementById("dateCol").innerText = translations[lang].dateCol;
      document.getElementById("actionCol").innerText = translations[lang].actionCol;
      loadReports();
    }

    document.getElementById("reportForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const report = {
        shop: document.getElementById("shop").value,
        device: document.getElementById("device").value,
        description: document.getElementById("description").value
      };
      await fetch("/api/report", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(report)
      });
      e.target.reset();
      loadReports();
    });

    async function loadReports() {
      const res = await fetch("/api/reports");
      const reports = await res.json();
      const table = document.getElementById("reportsTable");
      table.innerHTML = "";
      reports.forEach(r => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${r.shop}</td>
          <td>${r.device}</td>
          <td>${r.description}</td>
          <td>${translations[currentLang]["status_" + r.status]}</td>
          <td>${r.reportedAt}</td>
          <td>
            ${r.status === "Pending" 
              ? `<button onclick="completeTicket(${r.id})">${translations[currentLang].complete}</button>` 
              : "✔"}
          </td>
        `;
        table.appendChild(row);
      });
    }

    function completeTicket(id) {
      fetch(`/api/complete/${id}`, { method: "POST" })
        .then(() => loadReports());
    }

    setLang("uz");
  </script>
</body>
</html>
